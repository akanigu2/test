-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

-- Constants
local localPlayer = Players.LocalPlayer
local camera = workspace.CurrentCamera
local defaultWalkSpeed = 16
local maxSpeedMultiplier = 5

-- State
local espEnabled      = true
local noclipEnabled   = false
local guiVisible      = true
local drawingObjects  = {}
local currentSpeedPct = 0  -- 0..1 from slider

-- GUI setup
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = "AkaniguESP"
gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size               = UDim2.new(0, 260, 0, 180)  -- bigger
frame.Position           = UDim2.new(0, 10, 0, 10)
frame.BackgroundColor3   = Color3.new(0, 0, 0)
frame.BackgroundTransparency = 0.4
frame.BorderSizePixel    = 0
-- fade in
frame.BackgroundTransparency = 1
for i = 1, 10 do
    frame.BackgroundTransparency = 1 - i * 0.06
    task.wait(0.01)
end

-- ESP toggle
local espToggle = Instance.new("TextButton", frame)
espToggle.Size            = UDim2.new(0, 120, 0, 30)
espToggle.Position        = UDim2.new(0, 10, 0, 10)
espToggle.Text            = "ESP: ON"
espToggle.BackgroundColor3= Color3.new(0.2, 0.2, 0.2)
espToggle.TextColor3      = Color3.new(1, 1, 1)
espToggle.BorderSizePixel = 0
espToggle.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    espToggle.Text = espEnabled and "ESP: ON" or "ESP: OFF"
end)

-- Noclip toggle
local noclipToggle = Instance.new("TextButton", frame)
noclipToggle.Size         = UDim2.new(0, 120, 0, 30)
noclipToggle.Position     = UDim2.new(0, 130, 0, 10)
noclipToggle.Text         = "NoClip: OFF"
noclipToggle.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
noclipToggle.TextColor3   = Color3.new(1, 1, 1)
noclipToggle.BorderSizePixel = 0
noclipToggle.MouseButton1Click:Connect(function()
    noclipEnabled = not noclipEnabled
    noclipToggle.Text = noclipEnabled and "NoClip: ON" or "NoClip: OFF"
end)

-- WalkSpeed slider
local speedLabel = Instance.new("TextLabel", frame)
speedLabel.Size            = UDim2.new(1, -20, 0, 20)
speedLabel.Position        = UDim2.new(0, 10, 0, 55)
speedLabel.BackgroundTransparency = 1
speedLabel.TextColor3      = Color3.new(1,1,1)
speedLabel.TextXAlignment  = Enum.TextXAlignment.Left
speedLabel.Text            = "WalkSpeed: 1.0x"

local sliderBar = Instance.new("Frame", frame)
sliderBar.Size             = UDim2.new(1, -20, 0, 8)
sliderBar.Position         = UDim2.new(0, 10, 0, 85)
sliderBar.BackgroundColor3 = Color3.new(0.3,0.3,0.3)
sliderBar.BorderSizePixel  = 0

local sliderKnob = Instance.new("Frame", sliderBar)
sliderKnob.Size            = UDim2.new(0, 10, 1, 0)
sliderKnob.Position        = UDim2.new(0, 0, 0, 0)
sliderKnob.BackgroundColor3= Color3.new(1,1,1)
sliderKnob.BorderSizePixel = 0

local dragging = false
sliderKnob.InputBegan:Connect(function(i)
    if i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true end
end)
UserInputService.InputEnded:Connect(function(i)
    if i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
end)
UserInputService.InputChanged:Connect(function(i)
    if dragging and i.UserInputType == Enum.UserInputType.MouseMovement then
        local x = i.Position.X
        local barX = sliderBar.AbsolutePosition.X
        local barW = sliderBar.AbsoluteSize.X
        local pct = math.clamp((x - barX) / barW, 0, 1)
        sliderKnob.Position = UDim2.new(pct, -5, 0, 0)
        currentSpeedPct = pct
        local mult = 1 + (maxSpeedMultiplier - 1) * pct
        speedLabel.Text = ("WalkSpeed: %.1fx"):format(mult)
    end
end)

-- Credits
local creditLabel = Instance.new("TextLabel", frame)
creditLabel.Size            = UDim2.new(1, -20, 0, 20)
creditLabel.Position        = UDim2.new(0, 10, 1, -25)
creditLabel.BackgroundTransparency = 1
creditLabel.TextColor3      = Color3.new(1,1,1)
creditLabel.TextXAlignment  = Enum.TextXAlignment.Left
creditLabel.Text            = "Made by Akanigu"

-- Hide/show GUI (Right Ctrl)
UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == Enum.KeyCode.RightControl then
        guiVisible = not guiVisible
        gui.Enabled = guiVisible
    end
end)

-- Create ESP drawing objects
local function createEsp(player)
    if player == localPlayer or drawingObjects[player] then return end
    local t = {}
    t.name = Drawing.new("Text")
    t.name.Size    = 14; t.name.Outline=true; t.name.Center=true; t.name.Visible=false
    t.health = Drawing.new("Text")
    t.health.Size  = 13; t.health.Color=Color3.new(1,0,0); t.health.Outline=true; t.health.Center=true; t.health.Visible=false
    t.dist = Drawing.new("Text")
    t.dist.Size    = 13; t.dist.Color=Color3.new(1,1,1); t.dist.Outline=true; t.dist.Center=true; t.dist.Visible=false
    drawingObjects[player] = t
end

Players.PlayerRemoving:Connect(function(plr)
    local o = drawingObjects[plr]
    if not o then return end
    o.name:Remove(); o.health:Remove(); o.dist:Remove()
    drawingObjects[plr] = nil
end)

-- Main loop
RunService.RenderStepped:Connect(function()
    -- Enforce WalkSpeed
    local char = localPlayer.Character
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    if hum then
        local mult = 1 + (maxSpeedMultiplier - 1) * currentSpeedPct
        hum.WalkSpeed = defaultWalkSpeed * mult
    end

    -- Noclip + float
    if noclipEnabled and char then
        for _, part in pairs(char:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
        local hrp = char:FindFirstChild("HumanoidRootPart")
        if hrp then
            hrp.Velocity = Vector3.new(hrp.Velocity.X, 0, hrp.Velocity.Z)
        end
    end

    -- ESP
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= localPlayer then
            local c = player.Character
            local hrp = c and c:FindFirstChild("HumanoidRootPart")
            local h   = c and c:FindFirstChildOfClass("Humanoid")
            if hrp and h then
                createEsp(player)
                local o = drawingObjects[player]
                local pos, onScreen = camera:WorldToViewportPoint(hrp.Position + Vector3.new(0,3,0))
                if espEnabled and onScreen and h.Health > 0 then
                    o.name.Position   = Vector2.new(pos.X, pos.Y)
                    o.name.Text       = player.Name.." ["..tostring(player.Team).."]"
                    o.name.Color      = player.TeamColor.Color
                    o.name.Visible    = true

                    o.health.Position = Vector2.new(pos.X, pos.Y + 15)
                    o.health.Text     = "HP: "..math.floor(h.Health).."/"..math.floor(h.MaxHealth)
                    o.health.Visible  = true

                    local dist = (localPlayer.Character.HumanoidRootPart.Position - hrp.Position).Magnitude
                    o.dist.Position   = Vector2.new(pos.X, pos.Y + 30)
                    o.dist.Text       = "Dist: "..math.floor(dist)
                    o.dist.Visible    = true
                else
                    o.name.Visible    = false
                    o.health.Visible  = false
                    o.dist.Visible    = false
                end
            end
        end
    end
end)
